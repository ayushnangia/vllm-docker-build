# Dockerfile for SGLang parent commit da19434c2f3cbe4f367f84993da0bcbd84efb6ba
# This uses the "Proper" Triton Server base image found in the repo at this time.
# Architecture: linux/amd64 (GPU)

FROM nvcr.io/nvidia/tritonserver:24.01-py3

ENV DEBIAN_FRONTEND=noninteractive
ENV PYTHONDONTWRITEBYTECODE=1
ENV PYTHONUNBUFFERED=1

ARG SGLANG_COMMIT=da19434c2f3cbe4f367f84993da0bcbd84efb6ba

WORKDIR /sgl-workspace

# Copy ONLY the source for this specific commit
COPY . /sgl-workspace/sglang

# Install SGLang package and datasets (matching the repo's Triton Dockerfile)
WORKDIR /sgl-workspace/sglang
RUN pip install --upgrade pip && \
    pip install -e "python[all]" && \
    pip install datasets

# Write commit hash for verification
RUN mkdir -p /opt && echo "$SGLANG_COMMIT" > /opt/sglang_commit.txt

WORKDIR /sgl-workspace
CMD ["python3", "-c", "import sglang; print('SGLang Triton-based parent loaded successfully')"]
