{"commit": "a99801e0750f41553fedd02e36f58d835c4d4bd6", "Dockerfile": "ARG CUDA_VERSION=12.6.1\nFROM nvidia/cuda:${CUDA_VERSION}-cudnn-devel-ubuntu22.04\n\nARG BUILD_TYPE=all\nARG DEEPEP_COMMIT=b6ce310bb0b75079682d09bc2ebc063a074fbd58\nARG CMAKE_BUILD_PARALLEL_LEVEL=2\nENV DEBIAN_FRONTEND=noninteractive \\\n    CUDA_HOME=/usr/local/cuda \\\n    GDRCOPY_HOME=/usr/src/gdrdrv-2.4.4/ \\\n    NVSHMEM_DIR=/sgl-workspace/nvshmem/install\n\n# Set timezone and install all packages\nRUN echo 'tzdata tzdata/Areas select America' | debconf-set-selections \\\n && echo 'tzdata tzdata/Zones/America select Los_Angeles' | debconf-set-selections \\\n && apt-get update && apt-get install -y --no-install-recommends \\\n    tzdata \\\n    software-properties-common netcat-openbsd kmod unzip openssh-server \\\n    curl wget lsof zsh ccache tmux htop git-lfs tree \\\n    python3 python3-pip python3-dev libpython3-dev python3-venv \\\n    build-essential cmake \\\n    libopenmpi-dev libnuma1 libnuma-dev \\\n    libibverbs-dev libibverbs1 libibumad3 \\\n    librdmacm1 libnl-3-200 libnl-route-3-200 libnl-route-3-dev libnl-3-dev \\\n    ibverbs-providers infiniband-diags perftest \\\n    libgoogle-glog-dev libgtest-dev libjsoncpp-dev libunwind-dev \\\n    libboost-all-dev libssl-dev \\\n    libgrpc-dev libgrpc++-dev libprotobuf-dev protobuf-compiler-grpc \\\n    pybind11-dev \\\n    libhiredis-dev libcurl4-openssl-dev \\\n    libczmq4 libczmq-dev \\\n    libfabric-dev \\\n    patchelf \\\n    nvidia-dkms-550 \\\n    devscripts debhelper fakeroot dkms check libsubunit0 libsubunit-dev \\\n && ln -sf /usr/bin/python3 /usr/bin/python \\\n && rm -rf /var/lib/apt/lists/* \\\n && apt-get clean\n\n# GDRCopy installation\nRUN mkdir -p /tmp/gdrcopy && cd /tmp \\\n && git clone https://github.com/NVIDIA/gdrcopy.git -b v2.4.4 \\\n && cd gdrcopy/packages \\\n && CUDA=/usr/local/cuda ./build-deb-packages.sh \\\n && dpkg -i gdrdrv-dkms_*.deb libgdrapi_*.deb gdrcopy-tests_*.deb gdrcopy_*.deb \\\n && cd / && rm -rf /tmp/gdrcopy\n\n# Fix DeepEP IBGDA symlink\nRUN ln -sf /usr/lib/x86_64-linux-gnu/libmlx5.so.1 /usr/lib/x86_64-linux-gnu/libmlx5.so\n\n# Clone and install SGLang\nWORKDIR /sgl-workspace\nRUN python3 -m pip install --no-cache-dir --upgrade pip setuptools wheel html5lib six \\\n && git clone --depth=1 https://github.com/sgl-project/sglang.git \\\n && cd sglang \\\n && case \"$CUDA_VERSION\" in \\\n      12.6.1) CUINDEX=126 ;; \\\n      12.8.1) CUINDEX=128 ;; \\\n      *) echo \"Unsupported CUDA version: $CUDA_VERSION\" && exit 1 ;; \\\n    esac \\\n && python3 -m pip install --no-cache-dir -e \"python[${BUILD_TYPE}]\" --extra-index-url https://download.pytorch.org/whl/cu${CUINDEX} \\\n && if [ \"$CUDA_VERSION\" = \"12.8.1\" ]; then \\\n      python3 -m pip install --no-cache-dir nvidia-nccl-cu12==2.27.6 --force-reinstall --no-deps ; \\\n      python3 -m pip install --no-cache-dir https://github.com/sgl-project/whl/releases/download/v0.2.7/sgl_kernel-0.2.7+cu128-cp39-abi3-manylinux2014_x86_64.whl --force-reinstall --no-deps ; \\\n    fi\n\n# Build and install NVSHMEM + DeepEP\nRUN wget https://developer.download.nvidia.com/compute/redist/nvshmem/3.3.9/source/nvshmem_src_cuda12-all-all-3.3.9.tar.gz \\\n && git clone https://github.com/deepseek-ai/DeepEP.git \\\n && cd DeepEP && git checkout ${DEEPEP_COMMIT} && cd .. \\\n && tar -xf nvshmem_src_cuda12-all-all-3.3.9.tar.gz && mv nvshmem_src nvshmem \\\n && cd nvshmem \\\n && rm -f /sgl-workspace/nvshmem_src_cuda12-all-all-3.3.9.tar.gz \\\n && NVSHMEM_SHMEM_SUPPORT=0 \\\n    NVSHMEM_UCX_SUPPORT=0 \\\n    NVSHMEM_USE_NCCL=0 \\\n    NVSHMEM_MPI_SUPPORT=0 \\\n    NVSHMEM_IBGDA_SUPPORT=1 \\\n    NVSHMEM_PMIX_SUPPORT=0 \\\n    NVSHMEM_TIMEOUT_DEVICE_POLLING=0 \\\n    NVSHMEM_USE_GDRCOPY=1 \\\n    cmake -S . -B build/ -DCMAKE_INSTALL_PREFIX=${NVSHMEM_DIR} -DCMAKE_CUDA_ARCHITECTURES=90 \\\n && cmake --build build --target install -j${CMAKE_BUILD_PARALLEL_LEVEL} \\\n && cd /sgl-workspace/DeepEP \\\n && NVSHMEM_DIR=${NVSHMEM_DIR} pip install .\n\n# Python tools\nRUN python3 -m pip install --no-cache-dir \\\n    datamodel_code_generator \\\n    mooncake_transfer_engine==0.3.4.post2 \\\n    pre-commit \\\n    pytest \\\n    black \\\n    isort \\\n    icdiff \\\n    uv \\\n    wheel \\\n    scikit-build-core\n\n# Install development tools and utilities\nRUN apt-get update && apt-get install -y \\\n    gdb \\\n    ninja-build \\\n    vim \\\n    tmux \\\n    htop \\\n    wget \\\n    curl \\\n    locales \\\n    lsof \\\n    git \\\n    git-lfs \\\n    zsh \\\n    tree \\\n    silversearcher-ag \\\n    cloc \\\n    unzip \\\n    pkg-config \\\n    libssl-dev \\\n    bear \\\n    ccache \\\n    less \\\n    && apt install -y rdma-core infiniband-diags openssh-server perftest ibverbs-providers libibumad3 libibverbs1 libnl-3-200 libnl-route-3-200 librdmacm1 \\\n    && rm -rf /var/lib/apt/lists/* \\\n    && apt-get clean\n\nRUN apt update -y \\\n    && apt install -y --no-install-recommends gnupg \\\n    && echo \"deb http://developer.download.nvidia.com/devtools/repos/ubuntu2004/amd64 /\" | tee /etc/apt/sources.list.d/nvidia-devtools.list \\\n    && apt-key adv --fetch-keys http://developer.download.nvidia.com/compute/cuda/repos/ubuntu1804/x86_64/7fa2af80.pub \\\n    && apt update -y \\\n    && apt install nsight-systems-cli -y\n\n# Set up locale\nRUN locale-gen en_US.UTF-8\nENV LANG en_US.UTF-8\nENV LANGUAGE en_US:en\nENV LC_ALL en_US.UTF-8\n\n# Install minimal Python packages\nRUN python3 -m pip install --no-cache-dir --break-system-packages \\\n    pytest \\\n    black \\\n    isort \\\n    icdiff \\\n    scikit_build_core \\\n    uv \\\n    pre-commit \\\n    pandas \\\n    matplotlib \\\n    tabulate\n\n# Install diff-so-fancy\nRUN curl -LSso /usr/local/bin/diff-so-fancy https://github.com/so-fancy/diff-so-fancy/releases/download/v1.4.4/diff-so-fancy \\\n    && chmod +x /usr/local/bin/diff-so-fancy\n\n# Install clang-format\nRUN curl -LSso /usr/local/bin/clang-format https://github.com/muttleyxd/clang-tools-static-binaries/releases/download/master-32d3ac78/clang-format-16_linux-amd64 \\\n    && chmod +x /usr/local/bin/clang-format\n\n# Install clangd\nRUN curl -L https://github.com/clangd/clangd/releases/download/18.1.3/clangd-linux-18.1.3.zip -o clangd.zip \\\n    && unzip clangd.zip \\\n    && cp -r clangd_18.1.3/bin/* /usr/local/bin/ \\\n    && cp -r clangd_18.1.3/lib/* /usr/local/lib/ \\\n    && rm -rf clangd_18.1.3 clangd.zip\n\n# Install CMake\nRUN wget https://github.com/Kitware/CMake/releases/download/v3.31.1/cmake-3.31.1-linux-x86_64.tar.gz \\\n    && tar -xzf cmake-3.31.1-linux-x86_64.tar.gz \\\n    && cp -r cmake-3.31.1-linux-x86_64/bin/* /usr/local/bin/ \\\n    && cp -r cmake-3.31.1-linux-x86_64/share/* /usr/local/share/ \\\n    && rm -rf cmake-3.31.1-linux-x86_64 cmake-3.31.1-linux-x86_64.tar.gz\n\n# Add yank script\nCOPY --chown=root:root <<-\"EOF\" /usr/local/bin/yank\n#!/bin/bash\nput() {\n  esc=$1\n  test -n \"$TMUX\" -o -z \"${TERM##screen*}\" && esc=\"\\033Ptmux;\\033$esc\\033\\\\\"\n  printf \"$esc\"\n}\nput \"\\033]52;c;!\\a\"\nbuf=$( cat \"$@\" )\nlen=$( printf %s \"$buf\" | wc -c ) max=74994\ntest $len -gt $max && echo \"$0: input is $(( len - max )) bytes too long\" >&2\nput \"\\033]52;c;$( printf %s \"$buf\" | head -c $max | base64 | tr -d '\\r\\n' )\\a\"\ntest -n \"$TMUX\" && tmux set-buffer \"$buf\" ||:\nEOF\n\nRUN chmod +x /usr/local/bin/yank\n\n# Install oh-my-zsh and plugins\nRUN sh -c \"$(curl -fsSL https://raw.githubusercontent.com/ohmyzsh/ohmyzsh/master/tools/install.sh)\" \"\" --unattended \\\n    && git clone https://github.com/zsh-users/zsh-autosuggestions ${ZSH_CUSTOM:-~/.oh-my-zsh/custom}/plugins/zsh-autosuggestions \\\n    && git clone https://github.com/zsh-users/zsh-syntax-highlighting.git ${ZSH_CUSTOM:-~/.oh-my-zsh/custom}/plugins/zsh-syntax-highlighting\n\n# Configure Vim\nCOPY --chown=root:root <<-\"EOF\" /root/.vimrc\nfunction! Yank(text) abort\n  let escape = system('yank', a:text)\n  if v:shell_error\n    echoerr escape\n  else\n    call writefile([escape], '/dev/tty', 'b')\n  endif\nendfunction\n\nnoremap <silent> <Leader>y y:<C-U>call Yank(@0)<CR>\n\n\" automatically run yank(1) whenever yanking in Vim\nfunction! CopyYank() abort\n  call Yank(join(v:event.regcontents, \"\\n\"))\nendfunction\n\nautocmd TextYankPost * call CopyYank()\n\n\" Basic settings\nset number\nsyntax on\nset mouse=a\nfiletype indent on\n\n\" Indentation\nset autoindent nosmartindent\nset smarttab\nset expandtab\nset shiftwidth=4\nset softtabstop=4\n\n\" Visual guides\nset colorcolumn=120\nhighlight ColorColumn ctermbg=5\n\n\" Status line\nset laststatus=2\nset statusline=%<%f\\ %h%m%r%=%{\\\"[\\\".(&fenc==\\\"\\\"?&enc:&fenc).((exists(\\\"+bomb\\\")\\ &&\\ &bomb)?\\\",B\\\":\\\"\\\").\\\"]\\ \\\"}%k\\ %-14.(%l,%c%V%)\\ %P\n\n\" Backspace behavior\nset backspace=2\n\n\" Encoding\nset encoding=utf-8\nset fileencoding=utf-8\nEOF\n\n# Configure tmux\nCOPY --chown=root:root <<-\"EOF\" /root/.tmux.conf\n# Pane border styling\nset -g pane-border-style fg='#742727',bg=black\nset -g pane-active-border-style fg=red,bg=black\n\n# Status bar styling\nset -g status-style bg='#0C8A92',fg=black\n\n# Change prefix key to backtick\nset-option -g prefix `\nunbind C-b\nbind-key ` send-prefix\n\n# Split panes using - and = with current path\nunbind '\"'\nbind - splitw -v -c '#{pane_current_path}'\nunbind '%'\nbind = splitw -h -c '#{pane_current_path}'\n\n# Vi mode settings\nbind-key -T copy-mode-vi Y send-keys -X copy-pipe 'yank > #{pane_tty}'\nset-window-option -g mode-keys vi\n\n# Other settings\nset-option -g escape-time 0\nset-option -g base-index 1\nset-window-option -g mouse on\nEOF\n\n# Configure Git\nRUN git config --global core.editor \"vim\" \\\n    && git config --global core.whitespace \"fix,-indent-with-non-tab,trailing-space,cr-at-eol\" \\\n    && git config --global core.pager \"diff-so-fancy | less --tabs=4 -RFX\" \\\n    && git config --global color.ui true \\\n    && git config --global color.\"diff-highlight\".oldNormal \"red bold\" \\\n    && git config --global color.\"diff-highlight\".oldHighlight \"red bold 52\" \\\n    && git config --global color.\"diff-highlight\".newNormal \"green bold\" \\\n    && git config --global color.\"diff-highlight\".newHighlight \"green bold 22\" \\\n    && git config --global color.diff.meta \"11\" \\\n    && git config --global color.diff.frag \"magenta bold\" \\\n    && git config --global color.diff.commit \"yellow bold\" \\\n    && git config --global color.diff.old \"red bold\" \\\n    && git config --global color.diff.new \"green bold\" \\\n    && git config --global color.diff.whitespace \"red reverse\" \\\n    && git config --global alias.lg \"log --color --graph --pretty=format:'%Cred%h%Creset - %s %Cgreen(%cr) %C(bold blue)<%an>%Creset%C(auto)%d%Creset' --abbrev-commit --\" \\\n    && git config --global http.sslVerify false \\\n    && git config --global pull.rebase true\n\n# Configure zsh\nCOPY --chown=root:root <<-\"EOF\" /root/.zshrc\nexport ZSH=\"/root/.oh-my-zsh\"\n\n# Theme\nZSH_THEME=\"robbyrussell\"\n\n# Plugins\nplugins=(\n    git\n    z\n    zsh-autosuggestions\n    zsh-syntax-highlighting\n)\n\nsource $ZSH/oh-my-zsh.sh\n\n# Aliases\nalias ll='ls -alF'\nalias la='ls -A'\nalias l='ls -CF'\nalias vi='vim'\n\n# Enhanced history\nHISTSIZE=10000\nSAVEHIST=10000\nsetopt HIST_IGNORE_ALL_DUPS\nsetopt HIST_FIND_NO_DUPS\nsetopt INC_APPEND_HISTORY\nEOF\n\nRUN set -euxo ; \\\n    curl --proto '=https' --tlsv1.2 -sSf https://just.systems/install.sh | bash -s -- --to /usr/local/bin\n\n# Set workspace directory\nWORKDIR /sgl-workspace/sglang\n"}
{"commit": "4c605235aa832f259e148dfbdce08d9e471b5099", "Dockerfile": "ARG CUDA_VERSION=12.6.1\nFROM nvidia/cuda:${CUDA_VERSION}-cudnn-devel-ubuntu22.04\n\nARG BUILD_TYPE=all\nARG DEEPEP_COMMIT=b6ce310bb0b75079682d09bc2ebc063a074fbd58\nARG CMAKE_BUILD_PARALLEL_LEVEL=2\nENV DEBIAN_FRONTEND=noninteractive \\\n    CUDA_HOME=/usr/local/cuda \\\n    GDRCOPY_HOME=/usr/src/gdrdrv-2.4.4/ \\\n    NVSHMEM_DIR=/sgl-workspace/nvshmem/install\n\n# Set timezone and install all packages\nRUN echo 'tzdata tzdata/Areas select America' | debconf-set-selections \\\n && echo 'tzdata tzdata/Zones/America select Los_Angeles' | debconf-set-selections \\\n && apt-get update && apt-get install -y --no-install-recommends \\\n    tzdata \\\n    software-properties-common netcat-openbsd kmod unzip openssh-server \\\n    curl wget lsof zsh ccache tmux htop git-lfs tree \\\n    python3 python3-pip python3-dev libpython3-dev python3-venv \\\n    build-essential cmake \\\n    libopenmpi-dev libnuma1 libnuma-dev \\\n    libibverbs-dev libibverbs1 libibumad3 \\\n    librdmacm1 libnl-3-200 libnl-route-3-200 libnl-route-3-dev libnl-3-dev \\\n    ibverbs-providers infiniband-diags perftest \\\n    libgoogle-glog-dev libgtest-dev libjsoncpp-dev libunwind-dev \\\n    libboost-all-dev libssl-dev \\\n    libgrpc-dev libgrpc++-dev libprotobuf-dev protobuf-compiler-grpc \\\n    pybind11-dev \\\n    libhiredis-dev libcurl4-openssl-dev \\\n    libczmq4 libczmq-dev \\\n    libfabric-dev \\\n    patchelf \\\n    nvidia-dkms-550 \\\n    devscripts debhelper fakeroot dkms check libsubunit0 libsubunit-dev \\\n && ln -sf /usr/bin/python3 /usr/bin/python \\\n && rm -rf /var/lib/apt/lists/* \\\n && apt-get clean\n\n# GDRCopy installation\nRUN mkdir -p /tmp/gdrcopy && cd /tmp \\\n && git clone https://github.com/NVIDIA/gdrcopy.git -b v2.4.4 \\\n && cd gdrcopy/packages \\\n && CUDA=/usr/local/cuda ./build-deb-packages.sh \\\n && dpkg -i gdrdrv-dkms_*.deb libgdrapi_*.deb gdrcopy-tests_*.deb gdrcopy_*.deb \\\n && cd / && rm -rf /tmp/gdrcopy\n\n# Fix DeepEP IBGDA symlink\nRUN ln -sf /usr/lib/x86_64-linux-gnu/libmlx5.so.1 /usr/lib/x86_64-linux-gnu/libmlx5.so\n\n# Clone and install SGLang\nWORKDIR /sgl-workspace\nRUN python3 -m pip install --no-cache-dir --upgrade pip setuptools wheel html5lib six \\\n && git clone --depth=1 https://github.com/sgl-project/sglang.git \\\n && cd sglang \\\n && case \"$CUDA_VERSION\" in \\\n      12.6.1) CUINDEX=126 ;; \\\n      12.8.1) CUINDEX=128 ;; \\\n      *) echo \"Unsupported CUDA version: $CUDA_VERSION\" && exit 1 ;; \\\n    esac \\\n && python3 -m pip install --no-cache-dir -e \"python[${BUILD_TYPE}]\" --extra-index-url https://download.pytorch.org/whl/cu${CUINDEX} \\\n && if [ \"$CUDA_VERSION\" = \"12.8.1\" ]; then \\\n      python3 -m pip install --no-cache-dir nvidia-nccl-cu12==2.27.6 --force-reinstall --no-deps ; \\\n      python3 -m pip install --no-cache-dir https://github.com/sgl-project/whl/releases/download/v0.2.7/sgl_kernel-0.2.7+cu128-cp39-abi3-manylinux2014_x86_64.whl --force-reinstall --no-deps ; \\\n    fi\n\n# Build and install NVSHMEM + DeepEP\nRUN wget https://developer.download.nvidia.com/compute/redist/nvshmem/3.3.9/source/nvshmem_src_cuda12-all-all-3.3.9.tar.gz \\\n && git clone https://github.com/deepseek-ai/DeepEP.git \\\n && cd DeepEP && git checkout ${DEEPEP_COMMIT} && cd .. \\\n && tar -xf nvshmem_src_cuda12-all-all-3.3.9.tar.gz && mv nvshmem_src nvshmem \\\n && cd nvshmem \\\n && rm -f /sgl-workspace/nvshmem_src_cuda12-all-all-3.3.9.tar.gz \\\n && NVSHMEM_SHMEM_SUPPORT=0 \\\n    NVSHMEM_UCX_SUPPORT=0 \\\n    NVSHMEM_USE_NCCL=0 \\\n    NVSHMEM_MPI_SUPPORT=0 \\\n    NVSHMEM_IBGDA_SUPPORT=1 \\\n    NVSHMEM_PMIX_SUPPORT=0 \\\n    NVSHMEM_TIMEOUT_DEVICE_POLLING=0 \\\n    NVSHMEM_USE_GDRCOPY=1 \\\n    cmake -S . -B build/ -DCMAKE_INSTALL_PREFIX=${NVSHMEM_DIR} -DCMAKE_CUDA_ARCHITECTURES=90 \\\n && cmake --build build --target install -j${CMAKE_BUILD_PARALLEL_LEVEL} \\\n && cd /sgl-workspace/DeepEP \\\n && NVSHMEM_DIR=${NVSHMEM_DIR} pip install .\n\n# Python tools\nRUN python3 -m pip install --no-cache-dir \\\n    datamodel_code_generator \\\n    mooncake_transfer_engine==0.3.4.post2 \\\n    pre-commit \\\n    pytest \\\n    black \\\n    isort \\\n    icdiff \\\n    uv \\\n    wheel \\\n    scikit-build-core\n\n# Install development tools and utilities\nRUN apt-get update && apt-get install -y \\\n    gdb \\\n    ninja-build \\\n    vim \\\n    tmux \\\n    htop \\\n    wget \\\n    curl \\\n    locales \\\n    lsof \\\n    git \\\n    git-lfs \\\n    zsh \\\n    tree \\\n    silversearcher-ag \\\n    cloc \\\n    unzip \\\n    pkg-config \\\n    libssl-dev \\\n    bear \\\n    ccache \\\n    less \\\n    && apt install -y rdma-core infiniband-diags openssh-server perftest ibverbs-providers libibumad3 libibverbs1 libnl-3-200 libnl-route-3-200 librdmacm1 \\\n    && rm -rf /var/lib/apt/lists/* \\\n    && apt-get clean\n\nRUN apt update -y \\\n    && apt install -y --no-install-recommends gnupg \\\n    && echo \"deb http://developer.download.nvidia.com/devtools/repos/ubuntu2004/amd64 /\" | tee /etc/apt/sources.list.d/nvidia-devtools.list \\\n    && apt-key adv --fetch-keys http://developer.download.nvidia.com/compute/cuda/repos/ubuntu1804/x86_64/7fa2af80.pub \\\n    && apt update -y \\\n    && apt install nsight-systems-cli -y\n\n# Set up locale\nRUN locale-gen en_US.UTF-8\nENV LANG en_US.UTF-8\nENV LANGUAGE en_US:en\nENV LC_ALL en_US.UTF-8\n\n# Install minimal Python packages\nRUN python3 -m pip install --no-cache-dir --break-system-packages \\\n    pytest \\\n    black \\\n    isort \\\n    icdiff \\\n    scikit_build_core \\\n    uv \\\n    pre-commit \\\n    pandas \\\n    matplotlib \\\n    tabulate\n\n# Install diff-so-fancy\nRUN curl -LSso /usr/local/bin/diff-so-fancy https://github.com/so-fancy/diff-so-fancy/releases/download/v1.4.4/diff-so-fancy \\\n    && chmod +x /usr/local/bin/diff-so-fancy\n\n# Install clang-format\nRUN curl -LSso /usr/local/bin/clang-format https://github.com/muttleyxd/clang-tools-static-binaries/releases/download/master-32d3ac78/clang-format-16_linux-amd64 \\\n    && chmod +x /usr/local/bin/clang-format\n\n# Install clangd\nRUN curl -L https://github.com/clangd/clangd/releases/download/18.1.3/clangd-linux-18.1.3.zip -o clangd.zip \\\n    && unzip clangd.zip \\\n    && cp -r clangd_18.1.3/bin/* /usr/local/bin/ \\\n    && cp -r clangd_18.1.3/lib/* /usr/local/lib/ \\\n    && rm -rf clangd_18.1.3 clangd.zip\n\n# Install CMake\nRUN wget https://github.com/Kitware/CMake/releases/download/v3.31.1/cmake-3.31.1-linux-x86_64.tar.gz \\\n    && tar -xzf cmake-3.31.1-linux-x86_64.tar.gz \\\n    && cp -r cmake-3.31.1-linux-x86_64/bin/* /usr/local/bin/ \\\n    && cp -r cmake-3.31.1-linux-x86_64/share/* /usr/local/share/ \\\n    && rm -rf cmake-3.31.1-linux-x86_64 cmake-3.31.1-linux-x86_64.tar.gz\n\n# Add yank script\nCOPY --chown=root:root <<-\"EOF\" /usr/local/bin/yank\n#!/bin/bash\nput() {\n  esc=$1\n  test -n \"$TMUX\" -o -z \"${TERM##screen*}\" && esc=\"\\033Ptmux;\\033$esc\\033\\\\\"\n  printf \"$esc\"\n}\nput \"\\033]52;c;!\\a\"\nbuf=$( cat \"$@\" )\nlen=$( printf %s \"$buf\" | wc -c ) max=74994\ntest $len -gt $max && echo \"$0: input is $(( len - max )) bytes too long\" >&2\nput \"\\033]52;c;$( printf %s \"$buf\" | head -c $max | base64 | tr -d '\\r\\n' )\\a\"\ntest -n \"$TMUX\" && tmux set-buffer \"$buf\" ||:\nEOF\n\nRUN chmod +x /usr/local/bin/yank\n\n# Install oh-my-zsh and plugins\nRUN sh -c \"$(curl -fsSL https://raw.githubusercontent.com/ohmyzsh/ohmyzsh/master/tools/install.sh)\" \"\" --unattended \\\n    && git clone https://github.com/zsh-users/zsh-autosuggestions ${ZSH_CUSTOM:-~/.oh-my-zsh/custom}/plugins/zsh-autosuggestions \\\n    && git clone https://github.com/zsh-users/zsh-syntax-highlighting.git ${ZSH_CUSTOM:-~/.oh-my-zsh/custom}/plugins/zsh-syntax-highlighting\n\n# Configure Vim\nCOPY --chown=root:root <<-\"EOF\" /root/.vimrc\nfunction! Yank(text) abort\n  let escape = system('yank', a:text)\n  if v:shell_error\n    echoerr escape\n  else\n    call writefile([escape], '/dev/tty', 'b')\n  endif\nendfunction\n\nnoremap <silent> <Leader>y y:<C-U>call Yank(@0)<CR>\n\n\" automatically run yank(1) whenever yanking in Vim\nfunction! CopyYank() abort\n  call Yank(join(v:event.regcontents, \"\\n\"))\nendfunction\n\nautocmd TextYankPost * call CopyYank()\n\n\" Basic settings\nset number\nsyntax on\nset mouse=a\nfiletype indent on\n\n\" Indentation\nset autoindent nosmartindent\nset smarttab\nset expandtab\nset shiftwidth=4\nset softtabstop=4\n\n\" Visual guides\nset colorcolumn=120\nhighlight ColorColumn ctermbg=5\n\n\" Status line\nset laststatus=2\nset statusline=%<%f\\ %h%m%r%=%{\\\"[\\\".(&fenc==\\\"\\\"?&enc:&fenc).((exists(\\\"+bomb\\\")\\ &&\\ &bomb)?\\\",B\\\":\\\"\\\").\\\"]\\ \\\"}%k\\ %-14.(%l,%c%V%)\\ %P\n\n\" Backspace behavior\nset backspace=2\n\n\" Encoding\nset encoding=utf-8\nset fileencoding=utf-8\nEOF\n\n# Configure tmux\nCOPY --chown=root:root <<-\"EOF\" /root/.tmux.conf\n# Pane border styling\nset -g pane-border-style fg='#742727',bg=black\nset -g pane-active-border-style fg=red,bg=black\n\n# Status bar styling\nset -g status-style bg='#0C8A92',fg=black\n\n# Change prefix key to backtick\nset-option -g prefix `\nunbind C-b\nbind-key ` send-prefix\n\n# Split panes using - and = with current path\nunbind '\"'\nbind - splitw -v -c '#{pane_current_path}'\nunbind '%'\nbind = splitw -h -c '#{pane_current_path}'\n\n# Vi mode settings\nbind-key -T copy-mode-vi Y send-keys -X copy-pipe 'yank > #{pane_tty}'\nset-window-option -g mode-keys vi\n\n# Other settings\nset-option -g escape-time 0\nset-option -g base-index 1\nset-window-option -g mouse on\nEOF\n\n# Configure Git\nRUN git config --global core.editor \"vim\" \\\n    && git config --global core.whitespace \"fix,-indent-with-non-tab,trailing-space,cr-at-eol\" \\\n    && git config --global core.pager \"diff-so-fancy | less --tabs=4 -RFX\" \\\n    && git config --global color.ui true \\\n    && git config --global color.\"diff-highlight\".oldNormal \"red bold\" \\\n    && git config --global color.\"diff-highlight\".oldHighlight \"red bold 52\" \\\n    && git config --global color.\"diff-highlight\".newNormal \"green bold\" \\\n    && git config --global color.\"diff-highlight\".newHighlight \"green bold 22\" \\\n    && git config --global color.diff.meta \"11\" \\\n    && git config --global color.diff.frag \"magenta bold\" \\\n    && git config --global color.diff.commit \"yellow bold\" \\\n    && git config --global color.diff.old \"red bold\" \\\n    && git config --global color.diff.new \"green bold\" \\\n    && git config --global color.diff.whitespace \"red reverse\" \\\n    && git config --global alias.lg \"log --color --graph --pretty=format:'%Cred%h%Creset - %s %Cgreen(%cr) %C(bold blue)<%an>%Creset%C(auto)%d%Creset' --abbrev-commit --\" \\\n    && git config --global http.sslVerify false \\\n    && git config --global pull.rebase true\n\n# Configure zsh\nCOPY --chown=root:root <<-\"EOF\" /root/.zshrc\nexport ZSH=\"/root/.oh-my-zsh\"\n\n# Theme\nZSH_THEME=\"robbyrussell\"\n\n# Plugins\nplugins=(\n    git\n    z\n    zsh-autosuggestions\n    zsh-syntax-highlighting\n)\n\nsource $ZSH/oh-my-zsh.sh\n\n# Aliases\nalias ll='ls -alF'\nalias la='ls -A'\nalias l='ls -CF'\nalias vi='vim'\n\n# Enhanced history\nHISTSIZE=10000\nSAVEHIST=10000\nsetopt HIST_IGNORE_ALL_DUPS\nsetopt HIST_FIND_NO_DUPS\nsetopt INC_APPEND_HISTORY\nEOF\n\nRUN set -euxo ; \\\n    curl --proto '=https' --tlsv1.2 -sSf https://just.systems/install.sh | bash -s -- --to /usr/local/bin\n\n# Set workspace directory\nWORKDIR /sgl-workspace/sglang\n"}
